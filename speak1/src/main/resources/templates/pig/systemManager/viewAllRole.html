<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <meta charset="UTF-8">

  <title> </title>

  <meta http-equiv="pragma" content="no-cache">
  <meta http-equiv="cache-control" content="no-cache">
  <meta http-equiv="expires" content="0">
  <meta http-equiv="keywords" content="keyword1,keyword2,keyword3">
  <meta http-equiv="description" content="This is my page">
  <link href="../images/skin.css" rel="stylesheet" type="text/css" />
  <style type="text/css">
    body {
      margin-left: 0px;
      margin-top: 0px;
      margin-right: 0px;
      margin-bottom: 0px;
      background-color: #EEF2FB;
    }
  </style>
  <style type="text/css">
    <!--
    body {
      margin-left: 0px;
      margin-top: 0px;
      margin-right: 0px;
      margin-bottom: 0px;
    }
    .STYLE1 {font-size: 12px}
    .STYLE4 {
      font-size: 12px;
      color: #1F4A65;
      font-weight: bold;
    }

    a:link {
      font-size: 12px;
      color: #06482a;
      text-decoration: none;

    }
    a:visited {
      font-size: 12px;
      color: #06482a;
      text-decoration: none;
    }
    a:hover {
      font-size: 12px;
      color: #FF0000;
      text-decoration: underline;
    }
    a:active {
      font-size: 12px;
      color: #FF0000;
      text-decoration: none;
    }
    .STYLE7 {font-size: 12}

    -->
  </style>
  <script>
    var  highlightcolor='#EEF2FB';
    //此处clickcolor只能用win系统颜色代码才能成功,如果用#xxxxxx的代码就不行,还没搞清楚为什么:(
    var  clickcolor='red';
    function  changeto(){
      source=event.srcElement;
      if  (source.tagName=="TR"||source.tagName=="TABLE")
        return;
      while(source.tagName!="TD")
        source=source.parentElement;
      source=source.parentElement;
      cs  =  source.children;
      //alert(cs.length);
      if  (cs[1].style.backgroundColor!=highlightcolor&&source.id!="nc"&&cs[1].style.backgroundColor!=clickcolor)
        for(i=0;i<cs.length;i++){
          cs[i].style.backgroundColor=highlightcolor;
        }
    }

    function  changeback(){
      if  (event.fromElement.contains(event.toElement)||source.contains(event.toElement)||source.id=="nc")
        return
      if  (event.toElement!=source&&cs[1].style.backgroundColor!=clickcolor)
      //source.style.backgroundColor=originalcolor
        for(i=0;i<cs.length;i++){
          cs[i].style.backgroundColor="";
        }
    }

    function  clickto(){
      source=event.srcElement;
      if  (source.tagName=="TR"||source.tagName=="TABLE")
        return;
      while(source.tagName!="TD")
        source=source.parentElement;
      source=source.parentElement;
      cs  =  source.children;
      //alert(cs.length);
      if  (cs[1].style.backgroundColor!=clickcolor&&source.id!="nc")
        for(i=0;i<cs.length;i++){
          cs[i].style.backgroundColor=clickcolor;
        }
      else
        for(i=0;i<cs.length;i++){
          cs[i].style.backgroundColor="";
        }
    }
  </script>
  <script type="text/javascript">
    function subForm(pageIndex){
      document.getElementById('pageIndex').value = pageIndex;
      document.forms[0].submit();
    }





  </script>
</head>
<body>
<form action="car/role/findAllRole" method="post">
  <h5><font color="red"></font></h5>
</form>
<table width="100%" border="0" cellpadding="0" cellspacing="0">
  <tr>
    <td width="17" valign="top" background="../images/mail_leftbg.gif"><img src="../images/left-top-right.gif" width="17" height="29" /></td>
    <td valign="top" background="../images/content-bg.gif"><table width="100%" height="31" border="0" cellpadding="0" cellspacing="0" class="left_topbg" id="table2">
      <tr>
        <td height="31"><div class="titlebt">显示角色</div></td>
      </tr>
    </table></td>
    <td width="16" valign="top" background="../images/mail_rightbg.gif"><img src="../images/nav-right-bg.gif" width="16" height="29" /></td>
  </tr>
  <tr>
    <td valign="middle" background="../images/mail_leftbg.gif">&nbsp;</td>
    <td valign="top" bgcolor="#F7F8F9"><table width="98%" border="0" align="center" cellpadding="0" cellspacing="0">
      <tr>
        <td colspan="2" valign="top">&nbsp;</td>
        <td>&nbsp;</td>
        <td valign="top">&nbsp;</td>
      </tr>
      <tr>
        <td colspan="2" valign="top"><span class="left_bt">
     <!-- startTable -->
     <table width="100%" border="0" align="center" cellpadding="0" cellspacing="0">
  <tr>
    <td height="30"><table width="100%" border="0" cellspacing="0" cellpadding="0">
      <tr>
        <td width="15" height="30"><img src="../images/tab_03.gif" width="15" height="30" /></td>
        <td width="1101" background="../images/tab_05.gif"><img src="../images/311.gif" width="16" height="16" /> <span class="STYLE4">查询角色显示列表</span></td>
        <td width="281" background="../images/tab_05.gif"><table border="0" align="right" cellpadding="0" cellspacing="0">
            <tr>
              <td width="60"><table width="87%" border="0" cellpadding="0" cellspacing="0">
                  <tr>
                    <td class="STYLE1"><div align="center">
                        <input type="checkbox" name="checkbox62" value="checkbox" id="all" onClick="checkAll()"/>
                    </div></td>
                    <td class="STYLE1"><div align="center">全选</div></td>
                  </tr>
              </table></td>
              <td width="60"><table width="90%" border="0" cellpadding="0" cellspacing="0">
                  <tr>
                    <td class="STYLE1"><div align="center"><img src="../images/001.gif" width="14" height="14" /></div></td>
                    <td class="STYLE1"><div align="center"><a href="addRole.html">新增</a></div></td>
                  </tr>
              </table></td>
              <td width="52"><table width="88%" border="0" cellpadding="0" cellspacing="0">
                  <tr>
                    <td class="STYLE1"><div align="center"><img src="../images/083.gif" width="14" height="14" /></div></td>
                    <td class="STYLE1"><div align="center"><a href="#" onclick="pldelete()">删除</a></div></td>
                  </tr>
              </table></td>
            </tr>
        </table></td>
        <td width="14"><img src="../images/tab_07.gif" width="14" height="30" /></td>
      </tr>
    </table></td>
  </tr>
  <tr>
    <td><table width="100%" border="0" cellspacing="0" cellpadding="0">
      <tr>
        <td width="9" background="../images/tab_12.gif">&nbsp;</td>
        <td bgcolor="#f3ffe3"><table width="99%" border="0" id="rolelist" align="center" cellpadding="0" cellspacing="1" bgcolor="#c0de98" onmouseover="changeto()"  onmouseout="changeback()">

        </table></td>
        <td width="9" background="../images/tab_16.gif">&nbsp;</td>
      </tr>
    </table></td>
  </tr>
  <tr>
    <td height="29"><table width="100%" border="0" cellspacing="0" cellpadding="0">
      <tr>
        <td width="15" height="29"><img src="../images/tab_20.gif" width="15" height="29" /></td>
        <td background="../images/tab_21.gif"><table width="100%" border="0" cellspacing="0" cellpadding="0">
          <tr>
            <td width="25%" height="29" nowrap="nowrap" id="ty"> </td>
            <td width="75%" valign="top" class="STYLE1"><div align="right">
              <table width="352" height="20" border="0" cellpadding="0" id="page" cellspacing="0">

              </table>
            </div></td>
          </tr>
        </table></td>
        <td width="14"><img src="../images/tab_22.gif" width="14" height="29" /></td>
      </tr>
    </table></td>
  </tr>
</table>
          <!-- endTable -->


</span>
        </td>
      </tr>

      <tr>

        <td valign="top"><table width="100%" height="144" border="0" cellpadding="0" cellspacing="0" class="line_table">
        </table></td>
      </tr>
    </table></td>
    <td background="../images/mail_rightbg.gif">&nbsp;</td>
  </tr>
  <tr>
    <td valign="bottom" background="../images/mail_leftbg.gif"><img src="../images/buttom_left2.gif" width="17" height="17" /></td>
    <td background="../images/buttom_bgs.gif"><img src="../images/buttom_bgs.gif" width="17" height="17"></td>
    <td valign="bottom" background="../images/mail_rightbg.gif"><img src="../images/buttom_right2.gif" width="16" height="17" /></td>
  </tr>
</table>
</body>
<script src="../js/jquery-1.9.1.js"></script>
<script>

  /* window.location.href="car/role/queryRoleById?roleid="+roleId;*/
  /*  window.location.href="car/role/deleteRoleById?roleid="+roleId;*/
  function pldelete(){
    if(confirm("确定要进行此操作吗？")) {
      var arr = document.getElementsByName("dels");
      var ar = new Array();
      var o = 0;
      for (var i = 0; i < arr.length; i++) {
        if (arr[i].checked == true) {

          ar[o] = $(arr[i]).attr("value");
          o = o + 1;
        }
      }
      if(ar.length==0){
        alert('请选择要删除的用户！')
        return;
      }
      console.log(ar)
      $.ajax({
        url: "http://localhost:8080/role/deleteRoleByIds",
        data: {name: ar},
        type: "POST",
        async: false,
        traditional: true, //默认false
        success: function () {
          load(1);
        }
      });
    }
  }
  function deleteUser(roleid){
    if(window.confirm("您确定要这么做吗？")){
      $.ajax({
        url: "http://localhost:8080/role/deleteRoleById",
        data: {"roleid": roleid},
        type: "POST",
        async: false,
        success: function (data) {
          console.log(data)
          if(data)
            load(1);
          else
            alert('删除失败！')
        }
      });
    }else{
      return ;
    }
  }
  function preUpdate(roleid) {
    $.ajax({
      url: "http://localhost:8080/role/queryRoleById",
      data: {"roleid": roleid},
      type: "POST",
      crossDomain:true,
      xhrFields:{withCredentials:true},
      success: function (data) {
        location.href="updateRole.html"
      }
    });
  }
  function checkAll(){
    var obj = document.getElementById("all");
    var arr = document.getElementsByName("dels");
    for(var i = 0; i < arr.length; i++)
    {
      arr[i].checked = obj.checked;

    }
  }
  function subGo(index){

    var obj = document.getElementById('goPage').value;
    if(obj > index){
      alert("超出页数，请重新填写");
      return ;
    }else if(obj <= 0){
      alert("输入页数有误请重新输入");
      return ;
    }else{
      load(obj)
    }
  }
  load (1);

  function load (currentPage){
    var loginUser=''
    $.ajax({
      type:"get",
      url:"http://localhost:8080/user/getUserlogin",
      dataType:"json",
      crossDomain:true,
      async: false,
      xhrFields:{withCredentials:true},
      success:function (result) {
        loginUser= result
      }
    })
    var roleName;
    $.ajax({
      url: "http://localhost:8080/role/getsevaroleName",
      type: "get",
      crossDomain:true,
      dataType:"text",
      async:false,
      xhrFields:{withCredentials:true},
      success: function (data) {
        console.log(data)
        roleName=data;
      }
    });

    $.ajax({
      type: "get",
      dataType: "json",
      data:{"currentPage":currentPage,"roleName":roleName},
      async: false,
      url: "http://localhost:8080/role/findAllRole",
      success: function (result1) {
        console.log(result1);




        var str=' <tr>\n' +
                '            <td width="4%" height="26" background="../images/tab_14.gif" class="STYLE1"><div align="center" class="STYLE2 STYLE1">选择</div></td>\n' +
                '            <td width="8%" height="18" background="../images/tab_14.gif" class="STYLE1"><div align="center" class="STYLE2 STYLE1">角色编号</div></td>\n' +
                '            <td width="10%" height="18" background="../images/tab_14.gif" class="STYLE1"><div align="center" class="STYLE2 STYLE1">角色名</div></td>\n' +
                '            <td width="7%" height="18" background="../images/tab_14.gif" class="STYLE1"><div align="center" class="STYLE2">编辑</div></td>\n' +
                '            <td width="7%" height="18" background="../images/tab_14.gif" class="STYLE1"><div align="center" class="STYLE2">删除</div></td>\n' +
                '          </tr>'
        $.each(result1.roleList, function(i, role) {

          if(role.roleid==loginUser.user.roles.roleid){
            str+='<tr>\n' +
                    '<td height="18" bgcolor="#FFFFFF"><div align="center" class="STYLE1">\n' +
                    '<input name="dels" type="checkbox" class="STYLE2" value="' + role.roleid + '" />\n' +
                    '</div></td>\n' +
                    '\n' +
                    '<td height="18" bgcolor="#FFFFFF" class="STYLE2"><div align="center" class="STYLE2 STYLE1">' + role.roleid + '</div></td>\n' +
                    '<td height="18" bgcolor="#FFFFFF"><div align="center" class="STYLE2 STYLE1">' + role.rolename + '</div></td>\n' +
                    '<td height="18" bgcolor="#FFFFFF"><div align="center"><img src="../images/037.gif" width="9" height="9" /><span class="STYLE1"> </span><a href="#" onclick=preUpdate("' + role.roleid + '") style="font-size: 10px; cursor: hand; color: blue; ">编辑</a><span class="STYLE1"></span></div></td>\n' +
                    '<td height="18" bgcolor="#FFFFFF"><div align="center">  </div></td>\n' +
                    '</tr>'
          }else {
            str += '<tr>\n' +
                    '<td height="18" bgcolor="#FFFFFF"><div align="center" class="STYLE1">\n' +
                    '<input name="dels" type="checkbox" class="STYLE2" value="' + role.roleid + '" />\n' +
                    '</div></td>\n' +
                    '\n' +
                    '<td height="18" bgcolor="#FFFFFF" class="STYLE2"><div align="center" class="STYLE2 STYLE1">' + role.roleid + '</div></td>\n' +
                    '<td height="18" bgcolor="#FFFFFF"><div align="center" class="STYLE2 STYLE1">' + role.rolename + '</div></td>\n' +
                    '<td height="18" bgcolor="#FFFFFF"><div align="center"><img src="../images/037.gif" width="9" height="9" /><span class="STYLE1"> </span><a href="#" onclick=preUpdate("' + role.roleid + '") style="font-size: 10px; cursor: hand; color: blue; ">编辑</a><span class="STYLE1"></span></div></td>\n' +
                    '<td height="18" bgcolor="#FFFFFF"><div align="center"><span class="STYLE2"><img src="../images/010.gif" width="9" height="9" /> </span><span class="STYLE1">[</span><a href="#" onclick=deleteUser("' + role.roleid + '") style="font-size: 10px; cursor: hand; color: blue; ">删除</a><span class="STYLE1">]</span></div></td>\n' +
                    '</tr>'
          }

        })
        var pl='<span class="STYLE1">共 '+result1.page.totalCount+'条纪录，当前第'+result1.page.index+'/'+result1.page.totalPageCount+'页，每页'+result1.page.size +'条纪录</span>'


        var p='';

        if(result1.page.index>1){
          p+='<td width="62" height="22"><div align="right"><a href="#" onclick="load ('+ (1)+')" style="cursor: hand;"><img src="../images/first.gif" width="37" height="15"/></a></div></td>\n' +
                  '<td width="50" height="22" ><div align="right"><a href="#" onclick="load('+(result1.page.index -1)+')" style="cursor: hand;"><img src="../images/back2.gif" width="43" height="15" /></a></div></td>'
        }

        if(result1.page.index<result1.page.totalPageCount){
          p+='<td width="54" height="22" ><div align="right"><a href="#" onclick="load ('+ (result1.page.index +1)+')" style="cursor: hand;"><img src="../images/next.gif" width="43" height="15" /></a></div></td>\n' +
                  '<td width="49" height="22" ><div align="right"><a href="#" onclick="load ('+ (result1.page.totalPageCount)+')" style="cursor: hand;"><img src="../images/last.gif" width="37" height="15" /></a></div></td>'
        }

        p+='<td width="59" height="22" ><div align="right" class="STYLE2 STYLE1">转到第</div></td>\n' +
                '            <td width="25" height="22" ><span class="STYLE7">\n' +
                '                    <input name="textfield" oninput="value=value.replace(/[^\\d]/g,\'\')" type="text" class="STYLE1" style="height:20px; width:25px;" size="5" value="" id="goPage"/>\n' +
                '                    </span></td>\n' +
                '            <td width="23" height="22" class="STYLE2 STYLE1">页</td>\n' +
                '                    <td width="30" height="22" >' +
                '<a   onclick="subGo('+result1.page.totalPageCount+')" style="cursor: hand;">' +
                '<img src="../images/go.gif" width="37" height="15" /></a></td>\n'

        $('#page').html(p);
        $('#rolelist').html(str);
        $('#ty').html(pl);
      }
    });
  }

</script>
</html>
